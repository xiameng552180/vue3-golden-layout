{"ast":null,"code":"import { ComponentItemConfig } from '../config/config';\nimport { UnexpectedNullError } from '../errors/internal-error';\nimport { ComponentItem } from '../items/component-item';\nimport { GroundItem } from '../items/ground-item';\nimport { DragListener } from '../utils/drag-listener';\nimport { DragProxy } from './drag-proxy';\nimport { ResolvedRowOrColumnItemConfig } from \"../config/resolved-config\";\n/**\n * Allows for any DOM item to create a component on drag\n * start to be dragged into the Layout\n * @public\n */\n\nexport class DragSource {\n  /** @internal */\n  constructor(\n  /** @internal */\n  _layoutManager,\n  /** @internal */\n  _element,\n  /** @internal */\n  _extraAllowableChildTargets,\n  /** @internal */\n  _componentTypeOrFtn,\n  /** @internal */\n  _componentState,\n  /** @internal */\n  _title) {\n    this._layoutManager = _layoutManager;\n    this._element = _element;\n    this._extraAllowableChildTargets = _extraAllowableChildTargets;\n    this._componentTypeOrFtn = _componentTypeOrFtn;\n    this._componentState = _componentState;\n    this._title = _title;\n    this._dragListener = null;\n    this._dummyGroundContainer = document.createElement('div');\n    const dummyRootItemConfig = ResolvedRowOrColumnItemConfig.createDefault('row');\n    this._dummyGroundContentItem = new GroundItem(this._layoutManager, dummyRootItemConfig, this._dummyGroundContainer);\n    this.createDragListener();\n  }\n  /**\n   * Disposes of the drag listeners so the drag source is not usable any more.\n   * @internal\n   */\n\n\n  destroy() {\n    this.removeDragListener();\n  }\n  /**\n   * Called initially and after every drag\n   * @internal\n   */\n\n\n  createDragListener() {\n    this.removeDragListener();\n    this._dragListener = new DragListener(this._element, this._extraAllowableChildTargets);\n\n    this._dragListener.on('dragStart', (x, y) => this.onDragStart(x, y));\n\n    this._dragListener.on('dragStop', () => this.onDragStop());\n  }\n  /**\n   * Callback for the DragListener's dragStart event\n   *\n   * @param x - The x position of the mouse on dragStart\n   * @param y - The x position of the mouse on dragStart\n   * @internal\n   */\n\n\n  onDragStart(x, y) {\n    let componentType;\n    let componentState;\n    let title;\n\n    if (typeof this._componentTypeOrFtn === \"function\") {\n      const dragSourceItemConfig = this._componentTypeOrFtn();\n\n      componentType = dragSourceItemConfig.type;\n      componentState = dragSourceItemConfig.state;\n      title = dragSourceItemConfig.title;\n    } else {\n      componentType = this._componentTypeOrFtn;\n      componentState = this._componentState;\n      title = this._title;\n    } // Create a dummy ContentItem only for drag purposes\n    // All ContentItems (except for GroundItem) need a parent.  When dragging, the parent is not used.\n    // Instead of allowing null parents (as Javascript version did), use a temporary dummy GroundItem parent and add ContentItem to that\n    // If this does not work, need to create alternative GroundItem class\n\n\n    const itemConfig = {\n      type: 'component',\n      componentType,\n      componentState,\n      title\n    };\n    const resolvedItemConfig = ComponentItemConfig.resolve(itemConfig);\n    const componentItem = new ComponentItem(this._layoutManager, resolvedItemConfig, this._dummyGroundContentItem);\n\n    this._dummyGroundContentItem.contentItems.push(componentItem);\n\n    if (this._dragListener === null) {\n      throw new UnexpectedNullError('DSODSD66746');\n    } else {\n      const dragProxy = new DragProxy(x, y, this._dragListener, this._layoutManager, componentItem, this._dummyGroundContentItem);\n      const transitionIndicator = this._layoutManager.transitionIndicator;\n\n      if (transitionIndicator === null) {\n        throw new UnexpectedNullError('DSODST66746');\n      } else {\n        transitionIndicator.transitionElements(this._element, dragProxy.element);\n      }\n    }\n  }\n  /** @internal */\n\n\n  onDragStop() {\n    // if (this._dummyGroundContentItem === undefined) {\n    //     throw new UnexpectedUndefinedError('DSODSDRU08116');\n    // } else {\n    //     this._dummyGroundContentItem._$destroy\n    //     this._dummyGroundContentItem = undefined;\n    // }\n    this.createDragListener();\n  }\n  /**\n   * Called after every drag and when the drag source is being disposed of.\n   * @internal\n   */\n\n\n  removeDragListener() {\n    if (this._dragListener !== null) {\n      this._dragListener.destroy();\n\n      this._dragListener = null;\n    }\n  }\n\n}","map":{"version":3,"mappings":"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","names":["ComponentItemConfig","UnexpectedNullError","ComponentItem","GroundItem","DragListener","DragProxy","ResolvedRowOrColumnItemConfig","DragSource","constructor","_layoutManager","_element","_extraAllowableChildTargets","_componentTypeOrFtn","_componentState","_title","_dragListener","_dummyGroundContainer","document","createElement","dummyRootItemConfig","createDefault","_dummyGroundContentItem","createDragListener","destroy","removeDragListener","on","x","y","onDragStart","onDragStop","componentType","componentState","title","dragSourceItemConfig","type","state","itemConfig","resolvedItemConfig","resolve","componentItem","contentItems","push","dragProxy","transitionIndicator","transitionElements","element"],"sourceRoot":"","sources":["../../../../src/ts/controls/drag-source.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}