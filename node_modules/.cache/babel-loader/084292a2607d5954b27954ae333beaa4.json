{"ast":null,"code":"import { EventEmitter } from './event-emitter';\n/** @internal */\n\nexport class DragListener extends EventEmitter {\n  constructor(_eElement, extraAllowableChildTargets) {\n    super();\n    this._eElement = _eElement;\n    this._pointerTracking = false;\n\n    this._pointerDownEventListener = ev => this.onPointerDown(ev);\n\n    this._pointerMoveEventListener = ev => this.onPointerMove(ev);\n\n    this._pointerUpEventListener = ev => this.onPointerUp(ev);\n\n    this._timeout = undefined;\n    this._allowableTargets = [_eElement, ...extraAllowableChildTargets];\n    this._oDocument = document;\n    this._eBody = document.body;\n    /**\n     * The delay after which to start the drag in milliseconds\n     * Do NOT make too short (previous value of 200 was not long enough for my touchpad)\n     * Should generally rely on the mouse move to start drag.  Not this delay.\n     */\n\n    this._nDelay = 1800;\n    /**\n     * The distance the mouse needs to be moved to qualify as a drag\n     * Previous comment: works better with delay only\n     * ???\n     * Probably somehow needs tuning for different devices\n     */\n\n    this._nDistance = 10;\n    this._nX = 0;\n    this._nY = 0;\n    this._nOriginalX = 0;\n    this._nOriginalY = 0;\n    this._dragging = false;\n\n    this._eElement.addEventListener('pointerdown', this._pointerDownEventListener, {\n      passive: true\n    });\n  }\n\n  destroy() {\n    this.checkRemovePointerTrackingEventListeners();\n\n    this._eElement.removeEventListener('pointerdown', this._pointerDownEventListener);\n  }\n\n  cancelDrag() {\n    this.processDragStop(undefined);\n  }\n\n  onPointerDown(oEvent) {\n    if (this._allowableTargets.includes(oEvent.target) && oEvent.isPrimary) {\n      const coordinates = this.getPointerCoordinates(oEvent);\n      this.processPointerDown(coordinates);\n    }\n  }\n\n  processPointerDown(coordinates) {\n    this._nOriginalX = coordinates.x;\n    this._nOriginalY = coordinates.y;\n\n    this._oDocument.addEventListener('pointermove', this._pointerMoveEventListener);\n\n    this._oDocument.addEventListener('pointerup', this._pointerUpEventListener, {\n      passive: true\n    });\n\n    this._pointerTracking = true;\n    this._timeout = setTimeout(() => {\n      try {\n        this.startDrag();\n      } catch (err) {\n        console.error(err);\n        throw err;\n      }\n    }, this._nDelay);\n  }\n\n  onPointerMove(oEvent) {\n    if (this._pointerTracking) {\n      this.processDragMove(oEvent);\n      oEvent.preventDefault();\n    }\n  }\n\n  processDragMove(dragEvent) {\n    this._nX = dragEvent.pageX - this._nOriginalX;\n    this._nY = dragEvent.pageY - this._nOriginalY;\n\n    if (this._dragging === false) {\n      if (Math.abs(this._nX) > this._nDistance || Math.abs(this._nY) > this._nDistance) {\n        this.startDrag();\n      }\n    }\n\n    if (this._dragging) {\n      this.emit('drag', this._nX, this._nY, dragEvent);\n    }\n  }\n\n  onPointerUp(oEvent) {\n    this.processDragStop(oEvent);\n  }\n\n  processDragStop(dragEvent) {\n    var _a;\n\n    if (this._timeout !== undefined) {\n      clearTimeout(this._timeout);\n      this._timeout = undefined;\n    }\n\n    this.checkRemovePointerTrackingEventListeners();\n\n    if (this._dragging === true) {\n      this._eBody.classList.remove(\"lm_dragging\"\n      /* Dragging */\n      );\n\n      this._eElement.classList.remove(\"lm_dragging\"\n      /* Dragging */\n      );\n\n      (_a = this._oDocument.querySelector('iframe')) === null || _a === void 0 ? void 0 : _a.style.setProperty('pointer-events', '');\n      this._dragging = false;\n      this.emit('dragStop', dragEvent);\n    }\n  }\n\n  checkRemovePointerTrackingEventListeners() {\n    if (this._pointerTracking) {\n      this._oDocument.removeEventListener('pointermove', this._pointerMoveEventListener);\n\n      this._oDocument.removeEventListener('pointerup', this._pointerUpEventListener);\n\n      this._pointerTracking = false;\n    }\n  }\n\n  startDrag() {\n    var _a;\n\n    if (this._timeout !== undefined) {\n      clearTimeout(this._timeout);\n      this._timeout = undefined;\n    }\n\n    this._dragging = true;\n\n    this._eBody.classList.add(\"lm_dragging\"\n    /* Dragging */\n    );\n\n    this._eElement.classList.add(\"lm_dragging\"\n    /* Dragging */\n    );\n\n    (_a = this._oDocument.querySelector('iframe')) === null || _a === void 0 ? void 0 : _a.style.setProperty('pointer-events', 'none');\n    this.emit('dragStart', this._nOriginalX, this._nOriginalY);\n  }\n\n  getPointerCoordinates(event) {\n    const result = {\n      x: event.pageX,\n      y: event.pageY\n    };\n    return result;\n  }\n\n}","map":{"version":3,"mappings":"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","names":["EventEmitter","DragListener","constructor","_eElement","extraAllowableChildTargets","ev","onPointerDown","onPointerMove","onPointerUp","_timeout","undefined","_allowableTargets","_oDocument","document","_eBody","body","_nDelay","_nDistance","_nX","_nY","_nOriginalX","_nOriginalY","_dragging","addEventListener","_pointerDownEventListener","passive","destroy","checkRemovePointerTrackingEventListeners","removeEventListener","cancelDrag","processDragStop","oEvent","includes","target","isPrimary","coordinates","getPointerCoordinates","processPointerDown","x","y","_pointerMoveEventListener","_pointerUpEventListener","_pointerTracking","setTimeout","startDrag","err","console","error","processDragMove","preventDefault","dragEvent","pageX","pageY","Math","abs","emit","clearTimeout","classList","remove","querySelector","_a","style","setProperty","add","event","result"],"sourceRoot":"","sources":["../../../../src/ts/utils/drag-listener.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}